
@{
    ViewData["Title"] = "Updating Product Page";
}


@model UpdateProductModel
<div class="text-left w-25 mx-auto">
    <h1 class="text-center">CHANGING THE PRODUCT</h1>
    <div>
        <div>
            <label for="product-name">Product name: </label>
            <input id ="product-name" class="form-control w-100 mb-2" readonly value="@Model.Name"/>
        </div>
        <div>
             <label for ="quantity">Quantity: </label>
             <input id = "quantity" class=" form-control w-100 mb-2" min="0" oninput="validity.valid||(value='');" type="number" value="@Model.Quantity"/>
             </div>
        <div>
            <label for ="expiry-date">Expiry date:</label>
            <input id="expiry-date" class="form-control w-100" type="date"  value="@Model.ExpiryDate.ToString("yyyy-MM-dd")"  />
           
        </div>
        <div class="mt-2 d-flex justify-content-between">
            <a class="btn-info btn w-47 text-white" onclick="sendUpdatedProduct()">OK</a>
             <button class="btn-dark btn w-50"  onclick="backToProducts()">Cancel</button> 
            
        </div>
    </div>
</div>

<script>
function backToProducts() {
    let addr = new URL(document.URL);
    let fridgeId = addr.searchParams.get("fridgeId");
    document.location.href = "/Product/Products?fridgeId=" + fridgeId;
}

function checkProductProperties(name, expiryDate, quantity) {
    if (name === "") {
        alert("You didn't write product name.");
        return 1;
    }
    if (quantity === "") {
        alert("You didn't write quantity.");
        return 1;
    }
    if (expiryDate === "") {
        alert("You didn't write date.");
        return 1;
    }
}

function initPage() {
    document.getElementById("product-name").value = null;
    document.getElementById("quantity").value = null;
    document.getElementById("expiry-date").value = null;
}

function sendUpdatedProduct() {
    let addr = new URL(document.URL);
    let fridgeId = addr.searchParams.get("fridgeId");

    let updatedProductModel = {};
    updatedProductModel.Name = document.getElementById("product-name").value;
    updatedProductModel.Quantity = document.getElementById("quantity").value;
    updatedProductModel.ExpiryDate = document.getElementById("expiry-date").value;
    updatedProductModel.ProductId = @Model.ProductId;
    if (checkProductProperties(updatedProductModel.Name, updatedProductModel.ExpiryDate, updatedProductModel.Quantity) === 1)
        return;
    const url = `/Product/UpdateProduct?fridgeId=` + fridgeId;
    fetch(url, {
        method: 'post',
        headers: {
            "Content-type": "application/json; charset=UTF-8"
        },
        body: JSON.stringify(updatedProductModel)
    }).then((response) => {
        document.location.href = "/Product/Products?fridgeId=" + fridgeId;
    });

    initPage();

}

</script>